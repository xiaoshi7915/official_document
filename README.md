# 党政机关公文自动生成系统

基于GB/T9704-2012标准的党政机关公文自动生成系统，支持15种公文类型的模板化生成。

![系统预览](docs/preview.png)

## 功能特点

- **标准合规**：严格遵循GB/T9704-2012党政机关公文格式标准
- **多种公文类型**：支持15种常用公文类型（报告、公报、公告、函送、纪要、决定、决议、命令、批复、请示、通报、通告、通知、议案、意见）
- **AI智能生成**：集成DeepSeek大模型，支持从内容生成标题、从主题生成正文
- **完整字段管理**：支持公文的版头、主体、署名、版记、印发信息等完整字段
- **智能默认值**：所有非必填字段自动提供默认值提示，用户未输入时自动填充合理默认值
- **多格式支持**：支持Markdown、Word、纯文本格式输入和文件上传
- **智能模板预览**：动态加载实际模板图片，按文件夹实际数量显示
- **数据库存储**：MySQL数据库存储，支持历史记录和数据管理
- **自动排版**：根据标准自动进行公文排版
- **一键生成**：快速生成符合标准的公文Word文档
- **多域名访问**：支持本地和服务器域名访问，CORS配置完善

## 公文格式要求

### 正文格式规范
根据GB/T9704-2012标准，正文格式要求如下：

1. **一级标题**：用"一、"、"二、"、"三、"等，三号黑体字
2. **二级标题**：用"（一）"、"（二）"、"（三）"等，三号楷体_GB2312字
3. **三级标题**：用"1."、"2."、"3."等，三号仿宋_GB2312字，加粗
4. **正文内容**：三号仿宋_GB2312字
5. **行距**：一般为30磅

### 附件格式要求
- 如有附件，在正文下空一行左空二字编排"附件"二字，后标全角冒号和附件名称
- 如有多个附件，使用阿拉伯数字标注顺序
- 附件名称后不加标点
- 若附件名称较长需回行时，应与上一行附件名称的首字对齐
- "附件"在另起页用三号黑体字顶格编排在版心左上角第一行
- 附件标题居中编排在版心第三行
- 附件格式要求同正文

## 支持的公文类型

| 序号 | 类型 | 代码 | 描述 |
|------|------|------|------|
| 1 | **报告** | baogao | 向上级机关汇报工作、反映情况、回复询问 |
| 2 | **公报** | gongbao | 公开发布重要决议、决定或重大事件 |
| 3 | **公告** | gonggao | 向国内外宣布重要事项或者法定事项 |
| 4 | **函送** | hansong | 向有关单位送交公文或资料 |
| 5 | **纪要** | jiyao | 记载会议主要情况和议定事项 |
| 6 | **决定** | jueding | 对重要事项或重大行动作出安排 |
| 7 | **决议** | jueyi | 会议讨论通过的重要事项的决策 |
| 8 | **命令** | minglin | 依照有关法律公布行政法规和规章、宣布施行重大强制性措施 |
| 9 | **批复** | pifu | 答复下级机关请示事项 |
| 10 | **请示** | qingshi | 向上级机关请求指示或批准 |
| 11 | **通报** | tongbao | 表彰先进、批评错误、传达重要精神或情况 |
| 12 | **通告** | tonggao | 公开宣布重要事项或者法定事项 |
| 13 | **通知** | tongzhi | 发布、传达要求下级机关执行和有关单位周知或者执行的事项 |
| 14 | **议案** | yian | 正式提出审议事项的文书 |
| 15 | **意见** | yijian | 对重要问题提出见解和处理办法 |

## 技术架构

### 后端

- **Python + Flask**：提供高性能API服务
- **python-docx**：处理Word文档生成
- **mammoth**：Word文档转HTML
- **PIL**：图像处理和预览生成

### 前端

- **Vue 3**：现代化的前端框架
- **Element Plus**：UI组件库
- **Axios**：API请求处理
- **Vue Router**：前端路由管理

## 快速开始

### 环境要求

- Python 3.8+
- Node.js 16+
- npm 或 yarn

### 安装步骤

1. **克隆仓库**

```bash
git clone https://github.com/yourusername/official-document-generator.git
cd official-document-generator
```

2. **使用启动脚本（推荐）**

Linux/Mac:
```bash
./start_services.sh
```

停止服务:
```bash
./stop_services.sh
```

3. **手动安装**

后端安装：
```bash
cd backend
python -m venv venv
venv\Scripts\activate  # Windows
source venv/bin/activate  # Linux/Mac
pip install -r requirements.txt
```

前端安装：
```bash
cd frontend
npm install
```

### 启动服务

后端启动：
```bash
cd backend
python main.py
```

前端启动：
```bash
cd frontend
npm run dev
```

### 访问地址

- 本地访问：http://localhost:8081
- 服务器访问：http://121.36.205.70:8081
- 后端API：http://localhost:5002

## 项目结构

```
├── backend/           # Flask后端
│   ├── models/        # 数据模型
│   ├── services/      # 业务逻辑
│   ├── output/        # 生成的文档输出目录
│   └── temp/          # 临时文件目录
├── frontend/          # Vue前端
│   ├── public/        # 静态资源
│   │   └── templates/ # 模板图片目录
│   ├── src/           # 源代码
│   └── templates/     # 公文模板文件
└── docs/              # 文档
```

## 使用指南

1. 在首页选择需要的公文类型
2. 点击"预览模板"可以查看模板样式
3. 点击"使用此模板"或"开始生成公文"进入生成页面
4. 填写公文基本信息和正文内容
   - **必填字段**：公文类型、标题、发文机关、正文内容
   - **可选字段**：系统会自动提供默认值提示，用户未输入时会自动填充合理默认值
5. 点击"生成公文"按钮
6. 下载生成的Word文档

### 默认值说明

系统为所有非必填字段提供智能默认值：

- **份号**：默认 "000001"
- **密级**：默认 "一般"
- **保密期限**：默认 "1年"
- **紧急程度**：默认 "一般"
- **标志**：默认 "文件"
- **年份**：默认当前年份
- **成文日期**：默认当前日期
- **印发日期**：默认当前日期

所有默认值都会在输入框的占位符中显示，用户可以根据需要修改。

## 问题修复记录

### 2025-01-27 功能增强

1. **智能默认值功能**
   - 为所有非必填字段添加默认值提示
   - 实现自动填充默认值功能，用户未输入时自动填充合理默认值
   - 在页面加载、重置表单、生成公文时都会自动设置默认值
   - 所有输入框都显示默认值提示信息

2. **多域名访问支持**
   - 配置前端服务支持外部访问（host: '0.0.0.0'）
   - 更新后端CORS配置，允许特定域名访问
   - 支持通过 http://121.36.205.70:8081 访问系统
   - 创建便捷的启动和停止脚本

3. **用户体验优化**
   - 优化输入框占位符，明确标识必填和可选字段
   - 提供详细的默认值说明和使用指南
   - 改进表单验证和错误提示

### 2025-07-22 修复内容

1. **请求字段不完整问题**
   - 修复了前端发送的请求字段与后端期望字段不匹配的问题
   - 完善了版头、主体、署名、版记、印发等所有字段的传递

2. **公文格式要求实现**
   - 实现了GB/T9704-2012标准的段落格式要求
   - 支持一级标题（三号黑体字）、二级标题（三号楷体_GB2312字）、三级标题（三号仿宋_GB2312字加粗）、正文（三号仿宋_GB2312字）
   - 设置行距为30磅

3. **预览模板路由问题**
   - 修复了点击"预览模板"按钮时的路由错误
   - 正确传递模板ID参数，避免传递事件对象

4. **模板图片加载优化**
   - 优化了模板图片的动态加载逻辑
   - 支持按实际图片数量显示，避免404错误

## 贡献指南

欢迎贡献代码或提出建议！请遵循以下步骤：

1. Fork 本仓库
2. 创建您的特性分支 (`git checkout -b feature/amazing-feature`)
3. 提交您的更改 (`git commit -m 'Add some amazing feature'`)
4. 推送到分支 (`git push origin feature/amazing-feature`)
5. 打开一个 Pull Request

## 许可证

本项目采用 MIT 许可证 - 详见 [LICENSE](LICENSE) 文件

## 联系方式

如有问题或建议，请通过以下方式联系我们：

- 项目负责人：[您的名字](mailto:your.email@example.com)
- 项目主页：[GitHub项目地址](https://github.com/yourusername/official-document-generator)

## 致谢

- 感谢所有为本项目做出贡献的开发者
- 特别感谢提供公文标准和模板支持的相关机构